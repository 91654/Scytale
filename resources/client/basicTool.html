<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>BASIC CIPHER TOOL</title>
    <script>
        //translation alphabets
        const plaintextCharacters = ["A", "B", "C", "D", "E", "F", "G", "H", "I", "J", "K", "L", "M", "N", "O", "P", "Q", "R", "S", "T", "U", "V", "W", "X", "Y", "Z"];
        let ciphertextCharacters = ["-", "-", "-", "-", "-", "-", "-", "-", "-", "-", "-", "-", "-", "-", "-", "-", "-", "-", "-", "-", "-", "-", "-", "-", "-", "-"];

        //ciphertext message and corresponding plaintext message
        let ciphertextMessage = document.getElementById("inputMessage").innerText.toUpperCase();
        let plaintextMessage = "";

        //code for translation table
        function buildTranslationTable() {
            let dataHTML = "<tr><th>Plaintext</th><th>Ciphertext</th></tr>";
            for (let i = 0; i < 26; i++) {
                dataHTML += `<tr><td>${plaintextCharacters[i]}</td><td><input type='text' id='ciphertextChar${i}' value='${(ciphertextCharacters[i] === "-") ? "" : ciphertextCharacters[i]}'></td><tr>`;
            }
            document.getElementById("translationTable").innerHTML = dataHTML;
            document.getElementById("translationTable").addEventListener("keyup", updateText);
        }

        function updateText() {
            let oldCipherText = [...ciphertextCharacters];
            // Get new cipher text
            for (let i = 0; i < plaintextCharacters.length; i++) {
                let newLetter = document.getElementById(`ciphertextChar${i}`).value.toUpperCase();
                if (newLetter.length === 1 && newLetter.match(/[A-Z]/)) ciphertextCharacters[i] = newLetter;
                if (newLetter.length === 0) ciphertextCharacters[i] = "-";
            }
            for (let i = 0; i < plaintextCharacters.length; i++) {
                let oldLetter = oldCipherText[i];
                let currentLetter = ciphertextCharacters[i];
                if (oldLetter !== currentLetter) {
                    // New letter is different
                    if (currentLetter !== "") { // if it equals nothing, do nothing, if not:
                        // Check if new letter exists somewhere else in OLD one
                        if (oldCipherText.includes(currentLetter)) {
                            // It is in old one
                            ciphertextCharacters[oldCipherText.indexOf(currentLetter)] = "-";
                            oldCipherText[oldCipherText.indexOf(currentLetter)] = "-";
                        }
                    }
                }
            }
            buildTranslationTable();
        }






        //code for display flexboxes
        //need to create flexbox for user to enter ciphertextMessage and flexbox to output the plaintextMessage

        let cipherLetterArray = ciphertextMessage.split(''); //creates array of each character in ciphertextMessage
        let plainLetterArray = [];
        let containerBlock;
        let wordBlock;
        let letterBlock;
        let cipherLetter;
        let plainLetter;

        function createPlaintextMessage(){
            for (let i = 0; i < ciphertextMessage.length; i++){
                if (cipherLetterArray[i].match(/[A-Z]/)){
                    plainLetterArray[i] = plaintextCharacters[ciphertextCharacters.indexOf(cipherLetterArray[i])];
                } else {
                    plainLetterArray[i] = cipherLetterArray[i];
                }
            }
            plaintextMessage = plainLetterArray.join('');
            console.log(plaintextMessage);
            document.getElementById("outputMessage").innerHTML = plaintextMessage;
        }

        function createDivs(){
            containerBlock = document.getElementsByClassName("displayLetters"); // single vs double quotes https://stackoverflow.com/questions/44208081/js-quote-best-practices-es6-react-single-double-backticks
            for (let i = 0; i < cipherLetterArray.length; i++){ // loops for the number of words in the ciphertext inputted times
                wordBlock = document.createElement("div"); //creates a number of divs (equal to number of words)
                wordBlock.className = "word"; //sets class of these divs to word              TAKE OUT LATER: can talk about .className and .id vs setAttribute : https://stackoverflow.com/questions/33451050/classname-vs-get-setattribute-method
                containerBlock.appendChild(wordBlock); //adds each div inside the containerBlock

                for (let j = 0; j < cipherLetterArray[i].length; j++){ //loops for the length of each word (number of characters) times
                    letterBlock = document.createElement("div"); //creates a number of divs (equal to the number of characters in each word)
                    letterBlock.className = "letter"; //sets class of these divs to letter
                    wordBlock.appendChild(letterBlock); //adds each div inside the wordBlock

                    cipherLetter = document.createElement("div");
                    cipherLetter.innerHTML = cipherLetterArray[j];
                    letterBlock.appendChild(cipherLetter);

                    plainLetter = document.createElement("div");
                    plainLetter.innerHTML = plainLetterArray[j];
                    letterBlock.appendChild(plainLetter);
                }
            }
        }

        //creates letter frequency analysis table
        let letterFreq = [
            ["A", 0],
            ["B", 0],
            ["C", 0],
            ["D", 0],
            ["E", 0],
            ["F", 0],
            ["G", 0],
            ["H", 0],
            ["I", 0],
            ["J", 0],
            ["K", 0],
            ["L", 0],
            ["M", 0],
            ["N", 0],
            ["O", 0],
            ["P", 0],
            ["Q", 0],
            ["R", 0],
            ["S", 0],
            ["T", 0],
            ["U", 0],
            ["V", 0],
            ["W", 0],
            ["X", 0],
            ["Y", 0],
            ["Z", 0]
        ]
        let messageString;
        let totalLetters = 0;

        function calculateFrequency(){
            messageString = ciphertextMessage.split(' ').join(''); //removes spaces from user's ciphertext message
            for (let i = 0; i < messageString.length; i++){
                let currentCharacter = messageString.charAt(i);
                if (currentCharacter.match(/[A-Z]/)){ //only considers capitalised letters between A - Z
                    totalLetters++; //counts total letters
                    for (let j = 0; j < letterFreq.length; j++){
                        if (letterFreq[j][0] == currentCharacter){
                            letterFreq[j][1]++; //increases the frequency of the current character by 1
                        }
                    }
                }
            }

            for (let i = 0; i < letterFreq.length; i++){
                letterFreq[i][1] = ((letterFreq[i][1]/totalLetters)*100).toFixed(2); //converts frequencies to a percentage to 2 dp
            }

            letterFreq.sort(function(a,b) {
                return b[1]-a[1] //sorts the array into descending order by frequency
            });
        }

        function fillFreqValues(){
            for (let i = 0; i < 26; i++){
                document.getElementById('letter'+i).innerHTML = //FINISH
            }
        }





        //function to run necessary functions needed when page is loaded
        function start(){
            buildTranslationTable();
        }

    </script>
</head>

<body onload="start()">

<!--translation table-->
<table id="translationTable"></table>

<!--display flexboxes-->
<div class="messages">Enter ciphertext: <input type="text" id="inputMessage"></div>
<button onclick="createPlaintextMessage()"></button>
<div class ="displayLetters"></div>
<div class ="messages" id="outputMessage">Plaintext output: </div>

<!-- letter frequency tables-->
<div class="letterFrequency"> <!-- look into sorting them by letter/frequency? -->
    <div class="letterSource">
        <div class="heading">English</div>
        <div class="heading">
            <div class="values">Letter</div>
            <div class="values">E</div>
            <div class="values">T</div>
            <div class="values">A</div>
            <div class="values">O</div>
            <div class="values">I</div>
            <div class="values">N</div>
            <div class="values">S</div>
            <div class="values">R</div>
            <div class="values">H</div>
            <div class="values">D</div>
            <div class="values">L</div>
            <div class="values">U</div>
            <div class="values">C</div>
            <div class="values">M</div>
            <div class="values">F</div>
            <div class="values">Y</div>
            <div class="values">W</div>
            <div class="values">G</div>
            <div class="values">P</div>
            <div class="values">B</div>
            <div class="values">V</div>
            <div class="values">K</div>
            <div class="values">X</div>
            <div class="values">Q</div>
            <div class="values">J</div>
            <div class="values">Z</div>
        </div>
        <div class="heading">
            <div class="values">Frequency</div>
            <div class="values">12.02</div>
            <div class="values">9.10</div>
            <div class="values">8.12</div>
            <div class="values">7.68</div>
            <div class="values">7.31</div>
            <div class="values">6.95</div>
            <div class="values">6.28</div>
            <div class="values">6.02</div>
            <div class="values">5.92</div>
            <div class="values">4.32</div>
            <div class="values">3.98</div>
            <div class="values">2.88</div>
            <div class="values">2.71</div>
            <div class="values">2.61</div>
            <div class="values">2.30</div>
            <div class="values">2.11</div>
            <div class="values">2.09</div>
            <div class="values">2.03</div>
            <div class="values">1.82</div>
            <div class="values">1.49</div>
            <div class="values">1.11</div>
            <div class="values">0.69</div>
            <div class="values">0.17</div>
            <div class="values">0.11</div>
            <div class="values">0.10</div>
            <div class="values">0.07</div>
        </div>
    </div>
    <div class="letterSource">
        <div class="heading">Message</div>
        <div class="heading">
            <div class="values">Letter</div>
            <div class="values" id="letter0"></div>
            <div class="values" id="letter1"></div>
            <div class="values" id="letter2"></div>
            <div class="values" id="letter3"></div>
            <div class="values" id="letter4"></div>
            <div class="values" id="letter5"></div>
            <div class="values" id="letter6"></div>
            <div class="values" id="letter7"></div>
            <div class="values" id="letter8"></div>
            <div class="values" id="letter9"></div>
            <div class="values" id="letter10"></div>
            <div class="values" id="letter11"></div>
            <div class="values" id="letter12"></div>
            <div class="values" id="letter13"></div>
            <div class="values" id="letter14"></div>
            <div class="values" id="letter15"></div>
            <div class="values" id="letter16"></div>
            <div class="values" id="letter17"></div>
            <div class="values" id="letter18"></div>
            <div class="values" id="letter19"></div>
            <div class="values" id="letter20"></div>
            <div class="values" id="letter21"></div>
            <div class="values" id="letter22"></div>
            <div class="values" id="letter23"></div>
            <div class="values" id="letter24"></div>
            <div class="values" id="letter25"></div>
        </div>
        <div class="heading">
            <div class="values">Frequency</div>
            <div class="values" id="frequency0"></div>
            <div class="values" id="frequency1"></div>
            <div class="values" id="frequency2"></div>
            <div class="values" id="frequency3"></div>
            <div class="values" id="frequency4"></div>
            <div class="values" id="frequency5"></div>
            <div class="values" id="frequency6"></div>
            <div class="values" id="frequency7"></div>
            <div class="values" id="frequency8"></div>
            <div class="values" id="frequency9"></div>
            <div class="values" id="frequency10"></div>
            <div class="values" id="frequency11"></div>
            <div class="values" id="frequency12"></div>
            <div class="values" id="frequency13"></div>
            <div class="values" id="frequency14"></div>
            <div class="values" id="frequency15"></div>
            <div class="values" id="frequency16"></div>
            <div class="values" id="frequency17"></div>
            <div class="values" id="frequency18"></div>
            <div class="values" id="frequency19"></div>
            <div class="values" id="frequency20"></div>
            <div class="values" id="frequency21"></div>
            <div class="values" id="frequency22"></div>
            <div class="values" id="frequency23"></div>
            <div class="values" id="frequency24"></div>
            <div class="values" id="frequency25"></div>
        </div>
    </div>
</div>
</body>
</html>